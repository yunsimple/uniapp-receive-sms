<template>
	<view class="user">
		<view class="avatar">
			<u-avatar text="A" size="140rpx" fontSize="80rpx" randomBgColor></u-avatar>
		</view>
		
		<view v-if="userInfo" class="detail">
			<view class="username">
				<u--text :bold="true" size="35rpx" text="习近平"></u--text>
			</view>
			<view class="info">
				<u--text size="30rpx" text="金币:180"></u--text>
			</view>
			<view class="info">
				<u--text size="20rpx" text="最近登陆时间:2022-3-17 17:50:07"></u--text>
			</view>
		</view>
		
		<view v-else class="detail">
			<view class="username">
				<u--text :bold="true" size="40rpx" text="未登陆" @click="login"></u--text>
			</view>
			<view class="info">
				<u--text color="info" size="30rpx" text="登陆后显示更多信息" @click="login"></u--text>
			</view>
		</view>
	</view>
</template>

<script>
	import {
		http
	} from '@/utils/request.js'
	let aCache = getApp().globalData.aCache
	export default {
		data() {
			return {
				dataList: [],
				userInfo: null,
				nickName: null,
				username: null,

			}
		},
		created() {
			this.queryList()
		},
		methods: {
			queryList() {
				let self = this
				let hash = 'getUserinfo'
				if (aCache.has('getUserinfo')) {
					this.userInfo = self.aCache.get(hash)
				} else {
					console.log('u-my-user请求用户信息')
					http.post('/get_userinfo').then(res => {
						if (res.code === 0) {
							if (res.data.avatarUrl.length < 4) {
								res.data.avatarUrl = '/static/images/avatar/' + res.data.avatarUrl + '.png'
							}
							this.userInfo = res.data
							aCache.add('getUserinfo', res.data, 3600 * 24)
						}
					}).catch(err => {

					})
				}
			},
			login(){
				uni.$u.route('/pages/login')
			}
		}
	}
</script>

<style>
	.user {
		flex-flow: row nowrap;
		justify-content: flex-start;
		margin-top: 50rpx;
		margin-left: 10rpx;
	}

	.detail {
		margin-left: 20rpx;
		flex-direction: column;
		justify-content: center;
	}
</style>
